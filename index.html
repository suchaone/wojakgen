<html>
  <head>
    <style>
      #char {
        text-align: center;
      }
      #char-name {
        font-size: 20px;
        margin-top: 30px;
        margin-bottom: 10px;
        letter-spacing: .1em;
      }
      #char-attribute {
        font-style: italic;
        margin-bottom: 10px;
      }
      #generate {
        background: #9b8776;
        color: white;
        text-shadow: 0 0.5px 1px black;
        padding: 10px 20px;
        font-weight: bold;
        font-size: 15px;
        border: none;
        border-radius: 5px;
        border-bottom: 3px solid black;
        cursor: pointer;
      }
      #generate:hover {
        opacity: .9;
      }
      #generate:focus {
        outline:none;
      }
      #generate:active {
        border-bottom: 2px solid black;
        margin-top: 1px;
      }
      body {
        margin: 60px;
      }
    </style>
    <script>
      window.onload = function() {

        var NOUN = [ "cat", "dog", "sheep", "man", "woman", "ball", "tree", "lake", "stick", "rock", "river", "hat", "shoe", "staff", "cloak", "coin" ];
        var ADJECTIVE = [ "deranged", "deluded", "uncanny", "wayward", "fiery", "big", "tiny", "violent", "lying", "omnipresent", "omniscient", "fearful", "brave", "friendly", "playful" ];

        function makeTulpa (x, y) {
          var tulpa = {};
          tulpa.position = makePoint (x, y);
          tulpa.memes = [];
          tulpa.tulpas = [];
          var name = randomName();
          return tulpa;
        }

        var tulpas = [];
        for (var i = 0; i < 10; i++) {
          tulpas.push(makeTulpa(Math.random() * 10, Math.random() * 10));
        }

        // todo
        function randomMeme () {
          var forms = [
            "the ADJECTIVE claim that the ADJECTIVE NOUN is ADJECTIVE",
            "the ADJECTIVE NOUN is ADJECTIVE",
            "a belief that there is something ADJECTIVE about the NOUN",
            "the ADJECTIVE excitement about the NOUN",
            "the ADJECTIVE talk about the NOUN",
            "the ADJECTIVE whispers about the ADJECTIVE NOUN",
            "talking about the ADJECTIVE NOUN",
            "dancing like the ADJECTIVE NOUN",
            "singing like the ADJECTIVE NOUN",
            "the ADJECTIVE song about the ADJECTIVE NOUN",
          ];
          var form = pickRandom(forms);

          var adjectiveCount = (form.match(/ADJECTIVE/g) || []).length;
          var nounCount      = (form.match(/NOUN/g) || []).length;

          for (var i = 0; i <= adjectiveCount; i++) {
            form = form.replace("ADJECTIVE", pickRandom(ADJECTIVE));
          }

          for (var i = 0; i <= nounCount ; i++) {
            form = form.replace("NOUN", pickRandom(NOUN));
          }
          return form;
        }

        function randomAttribute() {
          var OPINION = [ 'partial towards', 'likes', 'dislikes', 'does not care for', 'cares for', 'despises', 'fears', 'adores', 'abhors', 'often thinks about', 'rarely considers', 'inspired by', 'friendly towards', 'prefers the company of', 'uneasy around', 'triggered by', 'beats up', 'keeps a tab on', 'suspicious of', 'respects', 'looks up to', 'says "no" to', 'defender of', 'looks down on', 'pities', 'envious of', 'writes fan fiction about', 'writes about', 'writes poems about', 'dreams about', 'obsessed with', 'cannot cope with', 'placated by', 'soothed by', 'enraged by', 'ignores', 'can\'t ignore', 'meditates on', 'sings about', 'blogs about', 'has a blog about', 'tweets about', 'posts about', 'studies', 'adores', 'idolizes', 'disrespects', 'fawns over', 'talks to', 'faps to', 'laughs at', 'comfortable with', 'uncomfortable around', 'understands', 'does\'t understand', 'confused by', 'beguiled by', 'makes memes about', 'jokes about', 'won\'t stop talking about', 'whispers to', 'shrieks at', 'screams at', 'yells at', 'yells about', 'raves about', 'talks at', 'offended by', 'chortles at', 'giggles at', 'amused by', 'snorts at', 'sneers at', 'made peace with', 'prefers the company of', 'questions the existence of', 'believes in', 'not afraid of', 'says \'yes\' to', 'ambivalent towards', 'puzzled by', 'has a problem with', 'has no problem with', 'only likes', 'engages with', 'unfazed by', 'smiles at', 'can\'t resist', 'thirsts for', 'can\'t resist smiling at', 'stands up for', 'stands up to', 'has a theory about', 'theorizes about', 'still on the fence about', 'conspires against', 'believes in conspiracy theories about', 'lives for', 'only interested in', 'has views on', 'wrote a manifesto about', 'fetishizes', 'lost his faith in', 'still believes in', 'speaks on behalf of', 'has a pinterest board about', 'can always count on', 'wrote a song about', 'wrote a poem about', 'writes thinkpieces about', 'wrote a thinkpiece about', 'worships', 'reveres', 'mocks', 'spits at', 'bites his thumb at', 'always at ease around', 'uneasy around', 'disgusted by', 'attracted to', 'complains about' ];
          var PLURAL = [ 'cats', 'dogs', 'sheep', 'spheres', 'trees', 'rocks', 'trains' , 'hats', 'shoes', 'bread', 'cushions', 'pokemon', 'cattle', 'memes', 'rhymes', 'monkeys', 'marmosets', 'tarsiers', 'books', 'stds', 'd&d rulebooks', 'miniatures', 'the demiurge', 'gods', 'demons', 'angels', 'math textbooks', 'ears', 'feet', 'hands', 'nose hairs', 'spells', 'pebbles', 'memorabilia', 'stamps', 'faberge eggs', 'peaches', 'emoji', 'anime', 'newts', 'waves', 'tunes', 'stories', 'logs', 'atoms', 'particles', 'potions', 'scars', 'wheels', 'cogs', 'pipes', 'manifestos', 'archons', 'hamsters', 'birds', 'the elderly', 'voters', 'the people', 'platonic forms', 'dreams', 'visions', 'hallucinations', 'strategies', 'pugs', 'words', 'numbers', 'chords', 'violins', 'video games', 'runes', 'cyphers', 'riddles', 'stickers', 'thinkpieces', 'DRUG', 'hot takes', 'whips', 'narcotics', 'gondolas', 'pepes', 'tights', 'buts', 'bulges', 'you', 'mandolins', 'guitars', 'harmonicas', 'balalaikas', 'roman coins', 'propaganda', 'swag', 'pokemon cards', 'magic cards', 'tarot cards', 'data', 'asuras', 'devas', 'owls', 'screenplays', 'diet tips' ];
          var ADJECTIVE = [ 'friendly', 'benevolent', 'understanding', 'clever', 'rude', 'friendly', 'paranoid', 'anxious', 'neurotic', 'disgusting', 'abhorent', 'timid', 'lazy', 'autistic', 'irreverent', 'irritable', 'depressed', 'sad', 'emotional', 'nihilistic', 'hedonistic', 'vulgar', 'ironic', 'unironic', 'postironic', 'violent', 'anhedonic', 'promiscuous', 'cunning', 'bashful', 'prudish', 'well-dressed', 'soft-spoken', 'audacious', 'unruly', 'orderly', 'clean', 'respectful', 'clueless', 'dirty', 'shrewd', 'shril', 'loud', 'demented', 'misunderstood', 'deranged', 'deluded', 'fiery', 'sincere', 'sensitive', 'horny', 'broke', 'wise', 'educated', 'uneducated', 'wishful', 'cautious', 'obsessive', 'anonymous', 'famous', 'unapologetic', 'shameless', 'beautiful', 'handsome', 'glamorous', 'foxy', 'comely', 'cute', 'graceful','gorgeous', 'ravishing','noble', 'hideous', 'reclusive', 'reptilian', 'revolting', 'monstrous', 'belligerent', 'peaceful', 'combative', 'pretentious', 'flamboyant', 'sophomoric', 'patrician', 'masculine', 'feminine', 'alpha', 'beta', 'omega', 'TRAITLY TRAITADJ', 'worried', 'naive', 'ignorant', 'woke', 'swole', 'RELIGION', 'generous' ];
          var PERSON = [ 'person', 'bloke', 'chap', 'lad', 'bro', 'fellow', 'fella', 'character', 'individual', 'citizen', 'boy', 'man', 'person', 'guy', 'soul', 'being', 'beast', 'creature', 'autist', 'madman', 'manchild', 'incel', 'volcel', 'solipsist', 'communist', 'anarchist', 'redditor', 'furry', 'larper', 'feminist', 'paleofeminist', 'male feminist', 'ally', 'white knight', 'prophet', 'otaku', 'singularian', 'apprentice', 'seer', 'bolshevik', 'nihilist', 'ally', 'addict', 'autocrat', 'racist', 'narcissist', 'masochist', 'sadist', 'librarian', 'fan', 'lolcow', 'hipster', 'normie', 'sophist', 'contrarian', 'goon', 'btard', 'poser', 'cat', 'bastard', 'gent', 'gentleman', 'mortal', 'male', 'adult', 'pessimist', 'optimist', 'sjw', 'fetishist', 'nympho', 'nomad', 'psychonaut', 'DRUGhead', 'DRUG user', 'subgenius', 'robot', 'fashionista', 'prole', 'pleb', 'raver', 'goth', 'hobo', 'DRUG addict', 'DRUG head', 'OCCUPATION', 'apologist' ];
          var OCCUPATION = [ 'engineer', 'troll', 'NEET', 'designer', 'magician', 'mathematician', 'researcher', 'ironist', 'author', 'shitposter', 'scientist', 'astrologist', 'alchemist', 'sage', 'philosopher', 'rapper', 'spy', 'prostitute', 'sex worker', 'poet', 'retiree', 'software developer', 'barista', 'marine', 'cop', 'wizard', 'makeup artist', 'artist', 'janitor', 'guitarist', 'journalist', 'blogger', 'camwhore', 'thief', 'DRUG dealer', 'grifter', 'truck driver', 'mercenary', 'doctor', 'mechanic', 'translator', 'florist', 'thought leader', 'consultant', 'ux designer', 'digital nomad', 'professor', 'dj', 'hacker', 'clown', 'politician', 'lawyer', 'product manager', 'haberdasher', 'soprano', 'educator', 'pedagogue', 'technocrat', 'startup founder', 'vp of PLURAL', 'director of PLURAL', 'master of PLURAL', 'necromancer', 'priest', 'druid', 'monk', 'occultist', 'blogger', 'vlogger' ];
          var NATIONALITY = [ 'canadian', 'american', 'russian', 'ukrainian', 'european', 'german', 'uzbek', 'albanian', 'algerian', 'armenian', 'australian', 'brit', 'dane', 'finn', 'swede', 'filipino', 'georgian', 'greek', 'israeli', 'macedonian', 'mongol', 'pole', 'spaniard', 'turk', 'arab', 'palestinian', 'jew', 'serb', 'indonesian', 'korean', 'armenian', 'aramean' ];
          var PREFIX = [ 'hyper', 'uber', 'meta', 'paleo', 'anarcho', 'xeno', 'post', 'anti', 'geo', 'neo', 'reconstructionist ', 'liberal ', 'conservative ', 'ultra', 'eco', 'crypto', 'reactionary ', 'revisionist ', 'queer ', 'radical ', 'moderate ', 'cyber' ];
          var IDEOLOGY = [ 'communist', 'capitalist', 'feminist', 'maoist', 'stalinist', 'primitivist', 'syndicalist', 'collectivist', 'egoist', 'platonist', 'realist', 'syndicalist','rationalist', 'modernist', 'singularian', 'fascist', 'natalist', 'naturist', 'democrat', 'conservative', 'liberal', 'nationalist', 'agrarian', 'federalist', 'isolationist', 'monarchist', 'libertarian', 'environmentalist', 'meninist', 'masculinist', 'progressivist', 'republican', 'socialist', 'islamist', 'zionist', 'radicalist', 'baathist', 'nasserist', 'arabist', 'jihadist', 'voluntarist' ];
          var CELEBRITY = [ 'stirner', 'zizek', 'dawkins', 'marx', 'trotsky', 'mao', 'cher', 'beyonce', 'kanye', 'kim kardashian', 'dril', 'stirner', 'nietzsche', 'plato', 'spinoza', 'kant', 'hagel', 'obama', 'trump', 'kissinger', 'putin', 'harambe', 'trudeau', 'stalin', 'lenin', 'kurzweil', 'thiel', 'yudkowsky', 'dhh', 'steve jobs', 'stallman', 'herzl', 'arafat', 'hillary', 'oprah', 'bjork', 'bowie', 'kierkegaard', 'murakami', 'manson', 'kaczynski', 'foucault', 'goethe', 'derrida', 'adam sandler', 'bill cosby', 'bernie sanders', 'ron paul', 'pkd', 'weev', 'milo' ];
          var VERY = [ 'very', 'fiercely', 'zealously', 'rather', 'singularly', 'distinctly', 'relatively', 'darn', 'mighty', 'devilishly', 'remarkably', 'highly', 'vaguely', 'faintly' ];
          var WRT = [ 'when it comes to', 'with regard to', 'around' ];
          var FAN = [ 'fan', 'fanboy', 'worshipper', 'admirer', 'acolyte', 'follower' ];
          var PEOPLE = [ 'fascists', 'communists', 'redditors', 'sjws', 'anarchists', 'incels', 'volcels', 'pokemon', 'furries', 'men', 'women', 'druids', 'magi', 'thieves', 'rascals', 'trolls', 'autists', 'feminists', 'shitposters', 'twitter users', 'thots', 'tinder users', 'redditors', 'btards', 'progs', 'crowds', 'DRUGheads', 'DRUG users', 'politicians', 'mansplainers', 'manspreaders', 'friends', 'ghosts', 'ghouls', 'skeletons', 'the undead', 'spooks', 'bros', 'dudebros', 'fuckboys', 'fashionistas', 'wizards', 'witches', 'warlocks', 'magicians', 'sorcerers', 'barbarians', 'sex workers', 'prostitutes', 'camwhores', 'lolcows', 'maidens', 'dames', 'qts', 'monstergirls', 'hippies', 'sluts', 'crossfit enthusiasts' ];
          var COMMON = [ 'your average', 'a common', 'just an ordinary', 'an ordinary', 'a garden variety', 'a retired', 'a burnt-out', 'a washed-out', 'your friendly neighborhood', 'not that kind of' ]
          var FRAME = [ 'always blogs about the time he', 'always tweets about how he', 'keeps talking about the time he', 'fondly remembers the time he', 'can\'t forget the time he', 'hasn\'t been the same since he', 'changed when he', 'forgets that he', 'blocked out the time that he', 'denies that he', 'proud that he', 'ashamed that he', 'not ashamed that he', 'rumored to have' ];
          var STORY = [ 'befriended', 'fought', 'punched', 'made love to', 'kissed', 'yelled at', 'was seduced by', 'was fooled by', 'was tricked into dating', 'dated', 'slapped', 'encountered', 'spoke to', 'was yelled at by', 'was lectured by', 'was educated by', 'had a heart-to-heart with', 'married', 'dated', 'divorced', 'broke up with', 'ran away from', 'ignored', 'loved', 'had a crush on', 'teamed up with', 'worked with', 'played with', 'talked to', 'laughted at', 'dreamed about', 'larped with', 'ran with', 'converted', 'won over', 'was won over by', 'made a deal with', 'slept with', 'rejected', 'interviewed', 'played VIDYA with', 'gaslighted', 'was gaslighted by' ];
          var DRUG = [ 'pot', 'meth', 'crack', 'coke', 'smack' ];
          var TRAITLY = [ 'existentially', 'physically', 'mentally', 'linguistically', 'psychically', 'emotionally', 'spiritually', 'sexually', 'artistically', 'musically', 'mathematically', 'epistemically', 'ideologically', 'socially' ];
          var TRAITADJ = [ 'challenged', 'gifted', 'inclined', 'driven', 'advanced', 'stunted', 'flexible', 'rigid', 'liberal', 'conservative', 'retarded' ];
          var VIDYA = [ 'heroes of might and magic', 'pokemon', 'mario', 'mortal kombat', 'zelda', 'sim city', 'minecraft', 'civ3', 'dota', 'league', 'starcraft', 'diablo', 'quake', 'tic-tac-toe' ];
          var RELIGION = [ 'christian', 'jewish', 'zoroastrian', 'animist', 'atheist', 'agnostic', 'hindu', 'orthodox', 'catholic', 'protestant', 'baptist' ];
          var XLY = [ 'gently', 'anxiously', 'ironically', 'unironically', 'exclusively', 'angrily', 'calmly', 'peacefully', 'expertly', 'ineptly', 'competently', 'incompetently', 'lazily', 'begrudgingly', 'professionally', 'religiously', 'occasionally' ];

          var forms = [
            'OPINION PLURAL',
            'OPINION certain PLURAL',
            'OPINION his PLURAL',
            'OPINION ADJECTIVE PEOPLE',
            'OPINION ADJECTIVE PEOPLE',
            'OPINION PEOPLE',
            'OPINION the PEOPLE',
            'OPINION VIDYA',
            'professional OCCUPATION',
            'amateur OCCUPATION',
            'career OCCUPATION',
            'full-time OCCUPATION',
            'part-time OCCUPATION',
            'tenured OCCUPATION',
            'unionized OCCUPATION',
            'XLY plays VIDYA',
            'plays VIDYA with PEOPLE',
            'ADJECTIVE VIDYA player',
            'OPINION PREFIXIDEOLOGYs',
            'OPINION IDEOLOGYs',
            'OPINION ADJECTIVE IDEOLOGYs',
            'COMMON IDEOLOGY',
            'COMMON PREFIXIDEOLOGY',
            'OPINION CELEBRITY FANs',
            'OPINION ADJECTIVE CELEBRITY FANs',
            'a VERY ADJECTIVE PERSON',
            'a VERY ADJECTIVE NATIONALITY',
            'COMMON PERSON',
            'RELIGION PERSON',
            'COMMON PREFIXIDEOLOGY',
            'COMMON NATIONALITY',
            'COMMON NATIONALITY PREFIXIDEOLOGY',
            'COMMON NATIONALITY IDEOLOGY',
            'ADJECTIVE CELEBRITY FAN',
            'IDEOLOGY CELEBRITY FAN',
            'ADJECTIVE CELEBRITY FAN',
            'FRAME STORY that ADJECTIVE PERSON',
            'FRAME STORY that ADJECTIVE IDEOLOGY',
            'FRAME STORY that ADJECTIVE NATIONALITY',
            'TRAITLY TRAITADJ PERSON',
            'TRAITLY TRAITADJ NATIONALITY',
            'TRAITLY TRAITADJ IDEOLOGY',
            'TRAITLY TRAITADJ CELEBRITY FAN',
          ];
          var form = pickRandom(forms);
          form = form.replace('OPINION', pickRandom(OPINION));
          form = form.replace('OCCUPATION', pickRandom(OCCUPATION));
          form = form.replace('PLURAL', pickRandom(PLURAL));
          form = form.replace('VERY', pickRandom(VERY));
          form = form.replace('ADJECTIVE', pickRandom(ADJECTIVE));
          form = form.replace('PERSON', pickRandom(PERSON));
          form = form.replace('WRT', pickRandom(WRT));
          form = form.replace('PEOPLE', pickRandom(PEOPLE));
          form = form.replace('COMMON', pickRandom(COMMON));
          form = form.replace('NATIONALITY', pickRandom(NATIONALITY));
          form = form.replace('PREFIX', pickRandom(PREFIX));
          form = form.replace('IDEOLOGY', pickRandom(IDEOLOGY));
          form = form.replace('CELEBRITY', pickRandom(CELEBRITY));
          form = form.replace('FAN', pickRandom(FAN));
          form = form.replace('FRAME', pickRandom(FRAME));
          form = form.replace('STORY', pickRandom(STORY));
          form = form.replace('DRUG', pickRandom(DRUG));
          form = form.replace('TRAITLY', pickRandom(TRAITLY));
          form = form.replace('TRAITADJ', pickRandom(TRAITADJ));
          form = form.replace('VIDYA', pickRandom(VIDYA));
          form = form.replace('XLY', pickRandom(XLY));
          form = form.replace('RELIGION', pickRandom(RELIGION));
          form = form.replace('liberal liberal', 'liberal');
          form = form.replace('conservative conservative', 'conservative');
          return form;
        }

        function pickRandom(ar) {
          return ar[Math.floor(Math.random() * ar.length)];
        }

        function randomBetween (min, max) {
          return (Math.random() * (max - min)) + min;
        } 

        function randomName (nationality) {
          var epithets = [ "wise", "doctor", "holy", "humble", "blissful", "great", "magnificent", "red", "black", "white", "bold", "craven", "foolish", "fierce", "arrogant", "timid", "blasphemous", "sexy", "lonely", "freaky", "dreamy", "zealous", "naughty", "enlightened", "sad", "oblivious", "confused", "arrogant", "cocky", "imaginative", "creative" ];
          var vowels = "aaaaaeeeeeeiiiooouuu";
          var consonants = "bbcddfghhjklmnprstvxzwwy";
          var name = "";
          var surname = "";
          var epithet = "";

          for (var i = 0; i < Math.random() * 4; i++) {
            name += pickRandom(consonants);
            name += pickRandom(vowels);
          }
          for (var i = 0; i < Math.random() * 5; i++) {
            surname += pickRandom(consonants);
            surname += pickRandom(vowels);
          }

          function russifyName (name) {
            name = name.replace("w","v"); //todo replaceall
            name = name.replace("h","kh");
            name = name.replace("j","zh");
            name = name.replace("c","k");
            name = name.replace("x","ks");
            return name + pickRandom(["", "slav", "nik"]);
          }

          function russifySurname (name) {
            name = name.replace("w","v"); //todo replaceall
            name = name.replace("h","kh");
            name = name.replace("j","zh");
            name = name.replace("c","k");
            name = name.replace("x","ks");
            return name + pickRandom(["nov", "novsky", "novich"]);
          }

          if (typeof nationality !== 'undefined' && nationality === 'russian') {
            name = russifyName(name);
            surname = russifySurname(surname);
          }

          name = name[0].toUpperCase() + name.slice(1);
          surname = surname[0].toUpperCase() + surname.slice(1);
          epithet = pickRandom(epithets);
          epithet = epithet[0].toUpperCase() + epithet.slice(1);


          if (Math.random() > 0.7)
            return epithet + " " + name + " " + surname;
          else if (Math.random() > 0.7)
            return name + " " + surname + " the " + epithet;
          else
            return name + " " + surname;
        }

        function makePoint (x, y) {
          return { x: x, y: y };
        }

        var images = new Map();

        images.set('base',   new Array(1));
        images.set('nose',   new Array(10));
        images.set('mouth',  new Array(9));
        images.set('detail', new Array(4));
        images.set('eyes',   new Array(5));
        images.set('mouth',  new Array(9));
        images.set('brows',  new Array(6));
        images.set('shirt',  new Array(11));
        images.set('beard',  new Array(9));
        images.set('stache', new Array(6));
        images.set('hair',   new Array(12));

        var imagesToLoad = 0;
        
        images.forEach(function(value, key) {
          imagesToLoad += value.length;
        });

        images.forEach(function(value, key) {
          var ar = value;
          for (var i = 0; i < ar.length; i++) {
            ar[i] = new Image();
            ar[i].src = 'img/' + key + (i+1) + '.png';
            ar[i].onload = function() {
              imagesToLoad--;
              if (imagesToLoad == 0) 
                drawRandom();
            };
          }
        });

        function drawRandom() {

          document.getElementById("char-name").innerHTML = randomName();
          document.getElementById("char-attribute").innerHTML = randomAttribute();

          var hairColors = {
            black: { h: 0, s: 0, l: -1 },
            gray:  { h: 0, s: -1, l: randomBetween(-.5,.5) },
            blond: { h: randomBetween(0.3, 0.33), s: randomBetween(-0.4, 0.4), l: randomBetween(-0.2,0.3)},
            brown: { h: randomBetween(0.28,0.3), s: randomBetween(-1,1), l:randomBetween(-0.35,-0.3) },
            red:   { h: randomBetween(0.15,0.23), s: randomBetween(-.3,.3), l:randomBetween(-0.1,-0.15) },
          }
          var keys = Object.keys(hairColors);
          var key = pickRandom(keys);
          var hairShift = hairColors[key];

          var canvas = document.getElementById('canvas');
          var ctx    = canvas.getContext('2d');

          ctx.clearRect(0, 0, 100, 100);
          images.forEach(function(value, key) {
            if ((key == 'beard' || key == 'stache') && Math.random() > 0.3)
              return 0;
            if ((key == 'hair') && Math.random() > 0.7)
              return 0;
            if ((key == 'detail') && Math.random() > 0.5)
              return 0;
            if ((key == 'shirt') && Math.random() > 0.8)
              return 0;
            draw(pickRandom(value), hairShift);
          });
        }

        function draw(img, hairShift) {
          var canvas  = document.getElementById('canvas');                        
          var canvas2 = document.getElementById('canvas2');
          var ctx     = canvas.getContext('2d');
          var ctx2    = canvas2.getContext('2d');

          ctx2.clearRect(0, 0, 100, 100);
          ctx2.drawImage(img, 0, 0);
          randomHSL(ctx2, hairShift);
          ctx.drawImage(canvas2, 0, 0);
        }

        function randomHSL(ctx, hairShift) {
          var imgData = ctx.getImageData(0,0, 100, 100);
          var data = imgData.data;
          for (var i = 0; i < data.length; i+= 4) {
            r = data[i];
            g = data[i+1];
            b = data[i+2];
            var hsl = rgbToHsl(r,g,b);

            if (hsl[0] > .7 && hsl[0] < .99) {
              hsl[0] += hairShift.h;
              if (hsl[0] > 1)
                hsl[0] -= 1;
              else if (hsl[0] < 0)
                hsl[0] += 1;

              hsl[1] += hairShift.s;
              if (hsl[1] > 1)
                hsl[1] = 1;
              else if (hsl[1] < 0)
                hsl[1] = 0;

              hsl[2] += hairShift.l;
              if (hsl[2] > 1)
                hsl[2] = 1;
              else if (hsl[1] < 0)
                hsl[2] = 0;
            }

            var newRGB = hslToRgb(hsl[0], hsl[1], hsl[2]);

            data[i]   = newRGB[0];
            data[i+1] = newRGB[1];
            data[i+2] = newRGB[2];
          }
          ctx.putImageData(imgData, 0, 0);
        }

        function hslToRgb(h, s, l){
          var r, g, b;
        
          if(s == 0){
            r = g = b = l; // achromatic
          } else {
            function hue2rgb(p, q, t){
              if(t < 0) t += 1;
              if(t > 1) t -= 1;
              if(t < 1/6) return p + (q - p) * 6 * t;
              if(t < 1/2) return q;
              if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
              return p;
            }
        
            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
          }
          return [r * 255, g * 255, b * 255];
        }
        
        function rgbToHsl(r, g, b){
          r /= 255, g /= 255, b /= 255;
          var max = Math.max(r, g, b), min = Math.min(r, g, b);
          var h, s, l = (max + min) / 2;
        
          if (max == min) {
            h = s = 0; // achromatic
          } else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max){
              case r: h = (g - b) / d + (g < b ? 6 : 0); break;
              case g: h = (b - r) / d + 2; break;
              case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
          }
          return [h, s, l];
        }

        document.getElementById("generate").onclick = drawRandom;
      
      }
    </script>
  </head>
  <body>
    <div id="char">
      <canvas id="canvas" width=100 height=100></canvas> 
      <canvas id="canvas2" width=100 height=100 style="display:none;"></canvas> 
      <div id="char-name"></div>
      <div id="char-attribute"></div>
      <br>
      <button id="generate">roll another?</button>
    </div>
  </body>
</html>
